# /etc/nginx/nginx.conf – routes /
#  →  Flask  (port 8000)
#  →  Telegram webhook (port 5000)
worker_processes auto;
events { worker_connections 1024; }

http {
  include       mime.types;
  default_type  application/octet-stream;
  sendfile      on;
  keepalive_timeout  65;

  upstream flask_app {
      server web:8000;
  }

  upstream telegram_webhook {
      server bot:5000;
  }

  server {
      listen 80;

      # Game & landing pages
      location / {
          proxy_pass         http://flask_app;
          proxy_set_header   Host $host;
          proxy_set_header   X-Real-IP $remote_addr;
          proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
      }

      # Telegram webhook endpoint
      location /telegram {
          proxy_pass http://telegram_webhook;
          proxy_set_header Host $host;
      }
  }
}
